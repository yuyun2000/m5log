微调使用的是LLaMA Factory：https://github.com/hiyouga/LLaMA-Factory
整个过程还是比较简单的：
1、先把上步中的数据集转换为LLaMA-F中推荐的格式：
![](../../file/Pasted%20image%2020251128112833.png)
2、然后修改dataset_info.json，加入你这个数据集，上面数据集文件名称是home_ass.json
![](../../file/Pasted%20image%2020251128112921.png)
3、记得修改LLaMA库中预设的身份数据集，把里面的名字换成你想要的
4、参考下面的微调代码就可以进行微调，我测试的是qwen2.5-0.5b，出来的效果基本够用，速度可以在1.5s内完成，加上asr、语音停顿和数据传输也可以在2s内控制完毕

https://colab.research.google.com/drive/1i_RSU8Y0EpkvfhfzVPPmuEvwcT_zIdxL?usp=sharing

建议使用3090以上的显卡微调，免费的t4太慢了

训练好的模型，以及数据集都放在了hf上：https://huggingface.co/yunyu1258/qwen2.5-0.5b-ha

同时也写了一个简单的控制服务，可以加载vad kws asr llm模型，输入ha的密钥后就可以进行局域网控制，但是需要llm8850加速卡来安装相关模型：https://github.com/yuyun2000/HomeAssistant-Edge
有兴趣的可以试一下

该项目目前只是半成品，实际应用还需要改进：
1、目前构想的是8850只负责推理，将asr和llm扩展为局域网内的服务，局域网内任何其他带麦克风的m5设备都可以接入控制服务，但是客户端代码还没有写
2、实际环境中设备多样性更大，目前没有广泛测试
3、微调样本需要进一步更新，包括但不限于：针对asr错别字、多音字识别的鲁棒性优化；针对端侧推理模式的优化，因为端侧为了提高响应速度，预先把系统指令计算好固定在内存中，不支持动态的内容输入，比如时间、设备实时状态等，需要重构微调样本调整动态内容输入来实现动态信息的问答；定时器等新功能...